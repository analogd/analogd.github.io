<!DOCTYPE html>
<html>
<head>
    <title>Cookbook Layer Example - SpeakerDesign</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
        h1 { color: #4ec9b0; }
        h2 { color: #569cd6; margin-top: 30px; }
        .result { background: #252526; padding: 15px; border-left: 3px solid #4ec9b0; margin: 10px 0; }
        .code { background: #1e1e1e; border: 1px solid #3c3c3c; padding: 10px; margin: 10px 0; }
        .good { color: #4ec9b0; }
        .warning { color: #ce9178; }
        .error { color: #f48771; }
        pre { margin: 0; }
    </style>
</head>
<body>
    <h1>üç≥ Cookbook Layer Examples</h1>
    <p>One-line design workflows for loudspeaker systems</p>

    <div id="output"></div>

    <script type="module">
        import * as Cookbook from './lib/cookbook/index.js';

        const output = document.getElementById('output');

        function log(title, content) {
            const div = document.createElement('div');
            div.className = 'result';
            div.innerHTML = `<h2>${title}</h2><pre>${content}</pre>`;
            output.appendChild(div);
        }

        // ================================================================
        // EXAMPLE DRIVER: Dayton Audio UM18-22 V2 (18" subwoofer)
        // ================================================================

        const driver = {
            name: 'Dayton Audio UM18-22 V2',
            fs: 22.0,      // Hz
            qts: 0.530,
            vas: 248.2,    // liters
            qes: 0.56,
            xmax: 18,      // mm (one-way)
            sd: 1140,      // cm¬≤
            pe: 1200,      // watts

            // Optional mechanical parameters (for accurate power limits)
            re: 6.4,       // ohms
            bl: 18.5,      // T¬∑m
            mms: 240       // grams
        };

        log('üì¶ Driver Specifications', JSON.stringify(driver, null, 2));

        // ================================================================
        // EXAMPLE 1: Quick Sealed Box Design
        // ================================================================

        try {
            const sealed = Cookbook.designSealedBox(driver, 'butterworth');

            log('Example 1: Sealed Butterworth Design',
                `Box Volume: ${sealed.box.volume.liters}L (${sealed.box.volume.cubicFeet} cu.ft)\n` +
                `Qtc: ${sealed.box.qtc} (${sealed.alignment.description})\n` +
                `Fc: ${sealed.box.fc}Hz\n` +
                `F3: ${sealed.box.f3}Hz (-3dB point)\n` +
                `\n` +
                `Efficiency: ${sealed.efficiency.eta0}%\n` +
                `Sensitivity: ${sealed.efficiency.spl0}dB @ 1W/1m\n` +
                `\n` +
                `Power Limits:\n` +
                `  Thermal: ${sealed.powerLimits.thermal}W\n` +
                `  20Hz: ${sealed.powerLimits.excursionLimited.at20Hz}W (excursion limited)\n` +
                `  30Hz: ${sealed.powerLimits.excursionLimited.at30Hz}W (excursion limited)\n` +
                `  50Hz: ${sealed.powerLimits.excursionLimited.at50Hz}W (excursion limited)`
            );
        } catch (err) {
            log('Example 1: ERROR', err.message);
        }

        // ================================================================
        // EXAMPLE 2: Ported QB3 Design
        // ================================================================

        try {
            const ported = Cookbook.designPortedBox(driver, 'QB3', {
                portDiameter: 10,  // cm (4 inches)
                ql: 7.0            // Typical well-sealed box
            });

            log('Example 2: Ported QB3 Design',
                `Box Volume: ${ported.box.volume.liters}L (${ported.box.volume.cubicFeet} cu.ft)\n` +
                `F3: ${ported.box.f3}Hz (-3dB point)\n` +
                `QL: ${ported.box.ql} (enclosure losses)\n` +
                `\n` +
                `Tuning:\n` +
                `  Fb: ${ported.tuning.fb}Hz\n` +
                `  Ratio Fb/Fs: ${ported.tuning.ratio}\n` +
                `\n` +
                `Port:\n` +
                `  Diameter: ${ported.port.diameter.cm}cm (${ported.port.diameter.inches}")\n` +
                `  Length: ${ported.port.length.cm}cm (${ported.port.length.inches}")\n` +
                `  Velocity: ${ported.port.velocity.value} m/s (${ported.port.velocity.status})\n` +
                `\n` +
                `Power Limits:\n` +
                `  Thermal: ${ported.powerLimits.thermal}W\n` +
                `  20Hz: ${ported.powerLimits.excursionLimited.at20Hz}W (excursion limited)\n` +
                `  At Fb (${ported.tuning.fb}Hz): ${ported.powerLimits.excursionLimited.atFb}W (excursion null!)\n` +
                `  50Hz: ${ported.powerLimits.excursionLimited.at50Hz}W (excursion limited)`
            );
        } catch (err) {
            log('Example 2: ERROR', err.message);
        }

        // ================================================================
        // EXAMPLE 3: Compare Sealed vs Ported
        // ================================================================

        try {
            const comparison = Cookbook.compareSealedVsPorted(driver);

            log('Example 3: Sealed vs Ported Comparison',
                `Recommendation: ${comparison.recommendation.toUpperCase()}\n` +
                `\n` +
                `Reasoning:\n${comparison.reasoning.map(r => `  ‚Ä¢ ${r}`).join('\n')}\n` +
                `\n` +
                `Summary:\n` +
                `  Sealed F3: ${comparison.summary.sealedF3}Hz\n` +
                `  Ported F3: ${comparison.summary.portedF3}Hz\n` +
                `  Bass Extension: ${comparison.summary.f3Improvement.toFixed(1)}Hz lower with ported\n` +
                `  \n` +
                `  Sealed Volume: ${comparison.summary.sealedVolume}L\n` +
                `  Ported Volume: ${comparison.summary.portedVolume}L\n` +
                `  Volume Ratio: ${comparison.summary.volumeRatio.toFixed(2)}x larger`
            );
        } catch (err) {
            log('Example 3: ERROR', err.message);
        }

        // ================================================================
        // EXAMPLE 4: Compare All Alignments
        // ================================================================

        try {
            const all = Cookbook.compareAllAlignments(driver);

            let output = 'All Viable Alignments (sorted by F3):\n\n';
            all.forEach((design, i) => {
                output += `${i + 1}. ${design.alignment.name} (${design.box ? 'sealed' : 'ported'})\n`;
                output += `   F3: ${design.box.f3}Hz\n`;
                output += `   Volume: ${design.box.volume.liters}L\n`;
                if (design.tuning) {
                    output += `   Fb: ${design.tuning.fb}Hz, Port: ${design.port.length.cm}cm\n`;
                }
                output += '\n';
            });

            log('Example 4: All Alignments', output);
        } catch (err) {
            log('Example 4: ERROR', err.message);
        }

        // ================================================================
        // EXAMPLE 5: Sensitivity Analysis
        // ================================================================

        try {
            const sensitivity = Cookbook.sensitivityAnalysis(
                driver,
                'qts',           // Vary Qts
                [-10, 10, 5]     // ¬±10% in 5% steps
            );

            let output = 'Effect of Qts tolerance on Butterworth sealed design:\n\n';
            sensitivity.forEach(result => {
                output += `Qts ${result.value.toFixed(3)} (${result.percent > 0 ? '+' : ''}${result.percent}%): ` +
                          `F3=${result.design.box.f3}Hz, ` +
                          `Vol=${result.design.box.volume.liters}L\n`;
            });

            log('Example 5: Sensitivity Analysis', output);
        } catch (err) {
            log('Example 5: ERROR', err.message);
        }

        // ================================================================
        // EXAMPLE 6: Target F3 Design
        // ================================================================

        try {
            const target = Cookbook.designForF3(driver, 20);  // Target F3 = 20Hz

            log('Example 6: Design for Target F3 = 20Hz',
                `Achieved F3: ${target.box.f3}Hz\n` +
                `Required Qtc: ${target.box.qtc}\n` +
                `Box Volume: ${target.box.volume.liters}L\n` +
                `Alignment: ${target.alignment.name}`
            );
        } catch (err) {
            log('Example 6: ERROR', err.message);
        }

        // ================================================================
        // SUMMARY
        // ================================================================

        log('‚úÖ Success!',
            'All cookbook layer functions executed successfully.\n' +
            '\n' +
            'Key Features:\n' +
            '  ‚Ä¢ One-line design workflows\n' +
            '  ‚Ä¢ Complete results with multiple unit formats\n' +
            '  ‚Ä¢ Accurate power limits (captures excursion null)\n' +
            '  ‚Ä¢ Loss modeling (QL) for realistic response\n' +
            '  ‚Ä¢ Comparison and analysis tools\n' +
            '  ‚Ä¢ Citations trace to source papers\n' +
            '\n' +
            'Architecture:\n' +
            '  Foundation (paper-true) ‚Üí Engineering (paper-close) ‚Üí Cookbook (user-friendly)\n' +
            '\n' +
            'See MASTER_SUMMARY_2025_11_02.md for complete documentation.'
        );
    </script>
</body>
</html>
